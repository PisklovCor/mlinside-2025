# PRD: Мульти-агентная система криптоанализа

## 1. Обзор продукта

### 1.1 Название проекта
CryptoAgents - Мульти-агентная система анализа криптовалют

### 1.2 Описание
Система представляет собой Java-приложение на базе Spring AI, которое анализирует криптовалютные токены с помощью трех специализированных агентов. Каждый агент выполняет свою роль в процессе анализа и предоставляет экспертное заключение.

### 1.3 Цели проекта
- Демонстрация применения мульти-агентных систем в финансовой аналитике
- Изучение возможностей Spring AI framework
- Создание модульной архитектуры с разделением ответственности между агентами
- Получение практического опыта интеграции с криптовалютными API

## 2. Целевая аудитория

### 2.1 Основная аудитория
- Студенты, изучающие AI и машинное обучение
- Преподаватели для оценки учебного проекта
- Разработчики, интересующиеся мульти-агентными системами

### 2.2 Вторичная аудитория
- Исследователи в области финтех
- Энтузиасты криптовалютной аналитики

## 3. Функциональные требования

### 3.1 Входные данные
- **Тикер токена**: Символьное обозначение криптовалюты (например, BTC, ETH, DOGE)
- **Формат ввода**: Строковый параметр через REST API или консольный интерфейс

### 3.2 Агент "Аналитик"
**Ответственность**: Технический анализ токена

**Функции**:
- Получение текущей цены токена
- Анализ исторических данных (объем торгов, изменения цены)
- Расчет технических индикаторов (SMA, RSI, MACD)
- Определение трендов и паттернов
- Анализ рыночной капитализации

**Выходные данные**:
- Текущая цена и изменение за 24ч
- Технические индикаторы
- Краткосрочный прогноз тренда
- Уровни поддержки и сопротивления

### 3.3 Агент "Риск-менеджер"
**Ответственность**: Оценка рисков инвестирования

**Функции**:
- Анализ волатильности токена
- Оценка ликвидности
- Анализ корреляции с основными криптовалютами
- Расчет VaR (Value at Risk)
- Оценка максимальной просадки

**Выходные данные**:
- Уровень риска (Низкий/Средний/Высокий)
- Показатели волатильности
- Рекомендации по размеру позиции
- Стоп-лосс уровни

### 3.4 Агент "Трейдер"
**Ответственность**: Торговые рекомендации

**Функции**:
- Анализ сигналов от других агентов
- Генерация торговых сигналов (BUY/SELL/HOLD)
- Определение точек входа и выхода
- Расчет соотношения риск/прибыль
- Формирование итогового заключения

**Выходные данные**:
- Торговая рекомендация (BUY/SELL/HOLD)
- Целевая цена
- Временной горизонт
- Обоснование решения

### 3.5 Координация агентов
- Последовательное выполнение анализа: Аналитик → Риск-менеджер → Трейдер
- Передача данных между агентами через общий контекст
- Агрегация результатов в итоговом отчете

## 4. Нефункциональные требования

### 4.1 Технические требования
- **Язык программирования**: Java 17+
- **Framework**: Spring Boot 3.x, Spring AI
- **Система сборки**: Maven или Gradle
- **База данных**: PostgreSQL 15+ (для хранения результатов анализа)
- **JDBC драйвер**: PostgreSQL JDBC Driver
- **Контейнеризация**: Docker для разработки (опционально)
- **API интеграции**: CoinGecko API или аналогичный бесплатный сервис

### 4.2 Производительность
- Время анализа одного токена: не более 30 секунд
- Поддержка одновременного анализа до 5 токенов
- Кэширование данных на 5 минут для избежания лимитов API

### 4.3 Надежность
- Обработка ошибок API (таймауты, лимиты запросов)
- Валидация входных данных
- Логирование всех операций
- Graceful degradation при недоступности внешних сервисов

### 4.4 Безопасность
- Валидация входных параметров
- Rate limiting для предотвращения злоупотреблений
- Безопасное хранение API ключей

## 5. Пользовательские истории

### 5.1 Базовые сценарии
**История 1**: Как пользователь, я хочу получить анализ токена BTC, чтобы понять текущую рыночную ситуацию

**Критерии приемки**:
- Система принимает тикер "BTC"
- Все три агента выполняют свои функции
- Получен комплексный отчет с рекомендациями

**История 2**: Как пользователь, я хочу увидеть детализированную информацию от каждого агента отдельно

**Критерии приемки**:
- Результаты каждого агента четко разделены
- Указано время выполнения анализа каждым агентом
- Доступна трассировка логики принятия решений

### 5.2 Расширенные сценарии
**История 3**: Как пользователь, я хочу сравнить анализ нескольких токенов одновременно

**Критерии приемки**:
- Поддержка множественного ввода тикеров
- Сравнительная таблица результатов
- Ранжирование по привлекательности

## 6. Техническая архитектура

### 6.1 Компоненты системы
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   REST API      │    │   Agent Manager  │    │   Data Service  │
│   Controller    │───▶│   Orchestrator   │◄──▶│   (CoinGecko)   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                              │
                              ▼
        ┌─────────────────────────────────────────────────────┐
        │                Agent Layer                          │
        ├─────────────────┬─────────────────┬─────────────────┤
        │   Analyst       │   Risk Manager  │     Trader      │
        │   Agent         │   Agent         │     Agent       │
        └─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ PostgreSQL DB   │
                    │   (Results)     │
                    └─────────────────┘
```

### 6.2 Ключевые классы
- `AgentOrchestrator` - координация выполнения агентов
- `AnalystAgent` - технический анализ
- `RiskManagerAgent` - управление рисками
- `TraderAgent` - торговые рекомендации
- `CryptoDataService` - интеграция с внешними API
- `AnalysisReport` - модель результата анализа

### 6.3 API интерфейсы
```
POST /api/analyze
Content-Type: application/json
{
  "ticker": "BTC"
}

Response:
{
  "ticker": "BTC",
  "timestamp": "2025-07-23T10:30:00Z",
  "analystReport": { ... },
  "riskReport": { ... },
  "traderReport": { ... },
  "finalRecommendation": "BUY"
}
```

### 6.4 Интеграции
- **CoinGecko API**: Получение рыночных данных
- **Spring AI**: LLM интеграция для интеллектуального анализа
- **PostgreSQL Database**: Хранение результатов анализа
- **Spring Actuator**: Мониторинг и метрики

## 7. Критерии приемки

### 7.1 Функциональные критерии
- ✅ Система успешно обрабатывает валидные тикеры криптовалют
- ✅ Все три агента выполняют свои функции и возвращают результаты
- ✅ Результаты корректно агрегируются в итоговом отчете
- ✅ API возвращает структурированный JSON ответ
- ✅ Обработка ошибочных тикеров с соответствующими сообщениями

### 7.2 Технические критерии
- ✅ Приложение запускается без ошибок
- ✅ Все тесты проходят успешно (покрытие >80%)
- ✅ Логирование работает корректно
- ✅ Документация API доступна через Swagger
- ✅ Конфигурация вынесена в application.properties (включая настройки PostgreSQL)

### 7.3 Качественные критерии
- ✅ Код соответствует стандартам Java (Google Style)
- ✅ Архитектура модульная и расширяемая
- ✅ Комментарии и документация на английском языке
- ✅ README с инструкциями по запуску

## 8. Временные рамки и приоритеты

### 8.1 Этапы разработки

**Этап 1: Базовая архитектура (Неделя 1)**
- Настройка Spring Boot проекта
- Конфигурация PostgreSQL и создание схемы БД
- Создание базовых классов агентов
- Интеграция с CoinGecko API
- Приоритет: ВЫСОКИЙ

**Этап 2: Реализация агентов (Неделя 2)**
- Агент "Аналитик"
- Агент "Риск-менеджер"
- Агент "Трейдер"
- Приоритет: ВЫСОКИЙ

**Этап 3: Интеграция Spring AI (Неделя 3)**
- Подключение LLM для интеллектуального анализа
- Оптимизация промптов для каждого агента
- Приоритет: СРЕДНИЙ

**Этап 4: API и тестирование (Неделя 4)**
- REST API контроллеры
- Unit и интеграционные тесты
- Документация
- Приоритет: ВЫСОКИЙ

### 8.2 MVP функции
- Анализ одного токена
- Базовая работа всех трех агентов
- REST API интерфейс
- Простое логирование

### 8.3 Дополнительные функции (Nice to have)
- Веб-интерфейс
- Исторический анализ
- Сравнение множественных токенов
- Экспорт отчетов в PDF
- Telegram бот интерфейс

## 9. Риски и ограничения

### 9.1 Технические риски
- **Лимиты API**: CoinGecko имеет ограничения на бесплатные запросы
- **Производительность LLM**: Задержки при обращении к внешним AI сервисам
- **Качество данных**: Неточность или недоступность данных с внешних API
- **Настройка PostgreSQL**: Необходимость развертывания и конфигурации БД

### 9.2 Учебные риски
- **Сложность Spring AI**: Необходимость изучения нового фреймворка
- **Временные ограничения**: Ограниченное время на выполнение проекта

### 9.3 Митигация рисков
- Использование кэширования для снижения нагрузки на API
- Fallback механизмы при недоступности внешних сервисов
- Использование Docker для упрощения развертывания PostgreSQL
- Детальное планирование и еженедельные чекпоинты

## 10. Метрики успеха

### 10.1 Технические метрики
- Время отклика API < 30 секунд
- Успешность обработки запросов > 95%
- Покрытие кода тестами > 80%

### 10.2 Образовательные метрики
- Демонстрация всех ключевых концепций мульти-агентных систем
- Успешная интеграция с внешними API
- Рабочий прототип с документацией

### 10.3 Качественные метрики
- Читаемость и поддерживаемость кода
- Полнота документации
- Соответствие требованиям задания

---

**Версия документа**: 1.0  
**Дата создания**: 23 июля 2025  
**Автор**: Учебный проект  
**Статус**: Утвержден для разработки